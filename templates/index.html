<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalãoApp - Demo Gerente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>.hidden{display:none;}</style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- LOGIN DEMO -->
    <div id="login" class="flex items-center justify-center min-h-screen">
        <div class="bg-white p-10 rounded-2xl shadow-2xl text-center max-w-md">
            <h1 class="text-4xl font-bold text-blue-600 mb-4">SalãoApp</h1>
            <p class="text-gray-600 mb-8">Demo para Portfólio - Apenas Gerente</p>
            
            <div class="bg-yellow-50 border border-yellow-300 p-6 rounded-xl mb-6">
                <p class="font-bold text-yellow-800 mb-3">Acesso Demo (Gerente)</p>
                <p class="text-sm"><strong>E-mail:</strong> gerente@salao.com</p>
                <p class="text-sm mb-4"><strong>Senha:</strong> demo123</p>
                <button onclick="loginDemo()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">
                    Entrar como Gerente (Demo)
                </button>
            </div>

            <p class="text-xs text-gray-500">
                Funcionalidades de Cliente e Funcionário desativadas temporariamente.
            </p>
        </div>
    </div>

    <!-- DASHBOARD GERENTE -->
    <div id="dashboard" class="hidden">
        <nav class="bg-blue-600 text-white p-4 shadow-lg">
            <div class="max-w-6xl mx-auto flex justify-between items-center">
                <h2 class="text-2xl font-bold">SalãoApp - Gerente</h2>
                <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded hover:bg-red-600">Sair</button>
            </div>
        </nav>

        <div class="max-w-6xl mx-auto p-6">
            <h1 class="text-3xl font-bold mb-8">Bem-vindo, Leonardo!</h1>

            <!-- CARDS FINANCEIROS -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                    <h3 class="text-gray-600">Faturamento</h3>
                    <p id="faturamento" class="text-4xl font-bold text-green-600">R$ 0,00</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                    <h3 class="text-gray-600">Comissões</h3>
                    <p id="comissoes" class="text-4xl font-bold text-orange-600">R$ 0,00</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                    <h3 class="text-gray-600">Lucro Líquido</h3>
                    <p id="lucro" class="text-4xl font-bold text-blue-600">R$ 0,00</p>
                </div>
            </div>

            <!-- SERVIÇOS -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <h3 class="text-xl font-bold mb-4">Serviços Cadastrados</h3>
                <div id="lista-servicos" class="space-y-3"></div>
            </div>

            <!-- AGENDA -->
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-bold mb-4">Agenda do Dia</h3>
                <div id="lista-agenda" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <script>
        function loginDemo() {
            fetch('/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({email: 'gerente@salao.com', senha: 'demo123'})
            }).then(r => r.json()).then(d => {
                if (d.success) {
                    document.getElementById('login').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    carregarTudo();
                }
            });
        }

        function logout() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
        }

        async function carregarTudo() {
            // Relatório
            const rel = await fetch('/api/relatorios/financeiro').then(r => r.json());
            document.getElementById('faturamento').innerText = `R$ ${rel.faturamento}`;
            document.getElementById('comissoes').innerText = `R$ ${rel.comissoes}`;
            document.getElementById('lucro').innerText = `R$ ${rel.lucro}`;

            // Serviços
            const serv = await fetch('/api/servicos').then(r => r.json());
            document.getElementById('lista-servicos').innerHTML = Object.values(serv).map(s => 
                `<div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <div><strong>${s.nome}</strong> - R$ ${s.valor} (Comissão: ${s.comissao_percentual}%)</div>
                </div>`
            ).join('');

            // Agenda
            const agend = await fetch('/api/agendamentos').then(r => r.json());
            document.getElementById('lista-agenda').innerHTML = Object.values(agend).map(a => 
                `<div class="flex justify-between items-center p-4 border rounded-lg ${a.status==='concluido'?'bg-green-50':'bg-yellow-50'}">
                    <div>
                        <strong>${a.nome_cliente}</strong> - ${a.nome_servico}<br>
                        <small>${a.data_agendamento} - ${a.status.toUpperCase()}</small>
                    </div>
                    ${a.status==='agendado' ? `<button onclick="concluir('${a.id}')" class="bg-green-600 text-white px-4 py-2 rounded">Concluir</button>` : ''}
                </div>`
            ).join('');
        }

        function concluir(id) {
            fetch(`/api/agendamentos/${id}/concluir`, {method: 'PATCH'}).then(() => carregarTudo());
        }
    </script>
</body>
</html>